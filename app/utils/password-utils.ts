import * as argon2 from "argon2";

// argon2 password hashing
// https://github.com/ranisalt/node-argon2/blob/e16fde8f1d2fff63803558e72ba043b85564eec9/argon2.js
// https://github.com/bitwarden/clients/pull/4468
// https://github.com/bitwarden/server/pull/2583
// https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#argon2id

export async function toPasswordHash(password: string): Promise<string> {
  // use default parameters https://github.com/ranisalt/node-argon2/blob/e16fde8f1d2fff63803558e72ba043b85564eec9/argon2.js#L15-L23
  // argon2id, m = 64MB, t = 3, p = 4
  return argon2.hash(password);
}

export async function verifyPassword(
  password: string,
  passwordHash: string
): Promise<boolean> {
  return argon2.verify(passwordHash, password);
}

export async function verifyPasswordNoop() {
  // dummy hash generated by
  //   node -r esbuild-register -e 'require("./app/utils/password-utils.ts").toPasswordHash("").then(console.log)'
  await argon2.verify(
    "$argon2id$v=19$m=65536,t=3,p=4$+YOxq1SCcC4D8TYbWNsdpw$8g0iZRKrbMQSkjAqsBcbaf+8j8fUxunnecydpZibvMM",
    "noop-for-timing-safety"
  );
}
